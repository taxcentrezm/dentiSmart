<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartDent ERP — Patients</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    .card { @apply bg-white rounded-2xl shadow p-4; }
    .glass {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .modal {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      justify-content: center;
      align-items: center;
      z-index: 50;
      animation: fadeIn 0.25s ease;
    }
    .modal.active { display: flex; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
  </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 antialiased">

  <!-- Header -->
  <header class="bg-indigo-600 text-white py-4 shadow">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-white/90 flex items-center justify-center shadow">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#374151" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 3v6"></path><path d="M8 10s1 2 4 2 4-2 4-2"></path><path d="M6 21s2-4 6-4 6 4 6 4"></path>
          </svg>
        </div>
        <div class="font-semibold text-lg">SmartDent ERP</div>
      </div>

      <div class="flex items-center gap-3">
        <button id="addBtn" class="bg-white/90 text-indigo-600 px-3 py-2 rounded-md inline-flex items-center gap-2 shadow-sm hover:bg-white">
          <i data-feather="plus-circle"></i> Add Patient
        </button>
        <div class="relative" id="doctorMenu">
          <button id="doctorBtn" class="flex items-center gap-2 bg-white/90 px-3 py-2 rounded-full shadow-sm hover:bg-white">
            <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=100&auto=format&fit=crop" class="w-8 h-8 rounded-full object-cover">
            <span class="hidden md:inline-block text-sm">Dr. Phiri</span>
            <i data-feather="chevron-down"></i>
          </button>
          <div id="doctorDropdown" class="absolute right-0 mt-2 w-40 bg-white rounded-xl shadow-md p-2 hidden">
            <button class="block w-full text-left px-3 py-2 rounded hover:bg-gray-100" id="profileBtn">Profile</button>
            <button class="block w-full text-left px-3 py-2 rounded hover:bg-gray-100" id="settingsBtn">Settings</button>
            <button class="block w-full text-left px-3 py-2 rounded hover:bg-gray-100 text-rose-600" id="logoutBtn">Logout</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Patient List -->
      <section class="lg:col-span-2 space-y-6">
        <div class="card">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold">Patient Records</h2>
            <div class="flex gap-2">
              <input id="searchInput" type="text" placeholder="Search…" class="px-3 py-2 border rounded-md" />
              <button id="searchBtn" class="px-3 py-2 border rounded-md"><i data-feather="search"></i></button>
            </div>
          </div>
          <ul id="patientList" class="space-y-4"></ul>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="space-y-6">
        <div class="card">
          <h3 class="font-semibold mb-3">Appointments Summary</h3>
          <ul class="space-y-2 text-sm">
            <li class="flex justify-between"><span>Today</span><span>38</span></li>
            <li class="flex justify-between"><span>Pending</span><span>5</span></li>
            <li class="flex justify-between"><span>Upcoming</span><span>12</span></li>
          </ul>
        </div>

        <div class="card">
          <h3 class="font-semibold mb-3">Quick Actions</h3>
          <div class="grid gap-3">
            <button id="scheduleBtn" class="flex items-center gap-3 px-4 py-2 rounded-lg bg-indigo-50 hover:bg-indigo-100"><i data-feather="calendar"></i> Schedule</button>
            <button id="manageBtn" class="flex items-center gap-3 px-4 py-2 rounded-lg bg-green-50 hover:bg-green-100"><i data-feather="users"></i> Manage Patients</button>
            <button id="invoiceBtn" class="flex items-center gap-3 px-4 py-2 rounded-lg bg-rose-50 hover:bg-rose-100"><i data-feather="file-text"></i> Invoicing</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="mt-8 text-sm text-gray-500 text-center">
    SmartDent ERP • Patient Management Simplified
  </footer>

  <!-- Patient Modal -->
  <div id="patientModal" class="modal">
    <div class="glass rounded-2xl p-6 w-full max-w-md relative">
      <h2 id="modalTitle" class="text-lg font-semibold mb-4">Add Patient</h2>
      <form id="patientForm" class="space-y-3">
        <input type="hidden" id="editIndex" />
        <input id="name" required placeholder="Full Name" class="w-full border rounded-md px-3 py-2" />
        <input id="note" required placeholder="Treatment / Note" class="w-full border rounded-md px-3 py-2" />
        <input id="date" type="date" class="w-full border rounded-md px-3 py-2" />
        <select id="status" class="w-full border rounded-md px-3 py-2">
          <option value="Paid">Paid</option>
          <option value="Invoice">Invoice</option>
          <option value="Overdue">Overdue</option>
        </select>
        <div class="flex justify-end gap-2 pt-2">
          <button type="button" id="deleteBtn" class="hidden px-3 py-2 bg-rose-50 text-rose-600 rounded-md hover:bg-rose-100">Delete</button>
          <button type="button" id="cancelBtn" class="px-3 py-2 border rounded-md">Cancel</button>
          <button type="submit" class="px-3 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    feather.replace();

    const modal = document.getElementById('patientModal');
    const form = document.getElementById('patientForm');
    const patientList = document.getElementById('patientList');
    const dateInput = document.getElementById('date');
    const deleteBtn = document.getElementById('deleteBtn');
    const editIndex = document.getElementById('editIndex');
    const modalTitle = document.getElementById('modalTitle');

    // Patients from localStorage
    let patients = JSON.parse(localStorage.getItem('patients')) || [];

    function saveData() {
      localStorage.setItem('patients', JSON.stringify(patients));
    }

    function render(list) {
      patientList.innerHTML = '';
      list.forEach((p, i) => {
        const initials = p.name.split(' ').map(s => s[0]).slice(0, 2).join('');
        const color =
          p.status === 'Paid' ? 'text-green-600' :
          p.status === 'Overdue' ? 'text-rose-600' :
          'text-amber-600';
        const li = document.createElement('li');
        li.className = 'flex items-center justify-between hover:bg-gray-50 p-2 rounded-lg cursor-pointer transition';
        li.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center font-semibold">${initials}</div>
            <div>
              <div class="font-medium">${p.name}</div>
              <div class="text-xs text-gray-500">${p.note} — ${p.date}</div>
            </div>
          </div>
          <div class="text-sm ${color}">${p.status}</div>
        `;
        li.onclick = () => openModal(i);
        patientList.appendChild(li);
      });
    }

    function openModal(index = null) {
      modal.classList.add('active');
      if (index !== null) {
        const p = patients[index];
        modalTitle.textContent = 'Edit Patient';
        form.name.value = p.name;
        form.note.value = p.note;
        form.date.value = p.date;
        form.status.value = p.status;
        editIndex.value = index;
        deleteBtn.classList.remove('hidden');
      } else {
        modalTitle.textContent = 'Add Patient';
        form.reset();
        form.date.value = new Date().toISOString().split('T')[0];
        editIndex.value = '';
        deleteBtn.classList.add('hidden');
      }
    }

    function closeModal() { modal.classList.remove('active'); }

    form.onsubmit = e => {
      e.preventDefault();
      const data = {
        name: form.name.value,
        note: form.note.value,
        date: form.date.value,
        status: form.status.value
      };
      if (editIndex.value) patients[editIndex.value] = data;
      else patients.push(data);
      saveData();
      render(patients);
      closeModal();
    };

    deleteBtn.onclick = () => {
      const pwd = prompt("Enter password to delete:");
      if (pwd === "admin123") {
        patients.splice(editIndex.value, 1);
        saveData();
        render(patients);
        closeModal();
      } else alert("Incorrect password!");
    };

    document.getElementById('cancelBtn').onclick = closeModal;
    document.getElementById('addBtn').onclick = () => openModal();
    window.onclick = e => { if (e.target === modal) closeModal(); };

    // Search
    document.getElementById('searchBtn').onclick = () => {
      const q = document.getElementById('searchInput').value.toLowerCase();
      render(patients.filter(p => p.name.toLowerCase().includes(q) || p.note.toLowerCase().includes(q)));
    };

    // Doctor dropdown
    const doctorBtn = document.getElementById('doctorBtn');
    const doctorDropdown = document.getElementById('doctorDropdown');
    doctorBtn.onclick = () => doctorDropdown.classList.toggle('hidden');
    window.addEventListener('click', e => {
      if (!doctorBtn.contains(e.target) && !doctorDropdown.contains(e.target)) doctorDropdown.classList.add('hidden');
    });

    document.getElementById('profileBtn').onclick = () => alert("Doctor Profile Page (coming soon)");
    document.getElementById('settingsBtn').onclick = () => alert("Settings Page (coming soon)");
    document.getElementById('logoutBtn').onclick = () => {
      if (confirm("Log out of SmartDent ERP?")) alert("Logged out successfully!");
    };

    // Quick Actions
    document.getElementById('scheduleBtn').onclick = () => alert("Schedule module loading…");
    document.getElementById('manageBtn').onclick = () => alert("Opening patient management…");
    document.getElementById('invoiceBtn').onclick = () => alert("Redirecting to invoicing…");

    render(patients);
  </script>
</body>
</html>
