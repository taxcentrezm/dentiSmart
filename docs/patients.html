<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartDent ERP — Patients</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f9fafb; }
    .card { @apply bg-white rounded-2xl shadow p-4; }

    /* Glass Modal */
    .modal {
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(0, 0, 0, 0.45); backdrop-filter: blur(6px);
      animation: fadeIn 0.25s ease forwards;
    }
    .modal.show { display: flex; }
    .modal-content {
      @apply bg-white/80 backdrop-blur-md rounded-2xl shadow-xl p-6 w-full max-w-md transform transition-all;
      animation: scaleIn 0.25s ease;
    }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    @keyframes scaleIn { from {opacity: 0; transform: scale(0.95);} to {opacity: 1; transform: scale(1);} }

    .status-pill { @apply px-2 py-0.5 text-xs font-semibold rounded-full; }

    /* Dropdown */
    .dropdown-menu {
      position: absolute;
      right: 0;
      top: 110%;
      @apply bg-white/90 backdrop-blur-md rounded-xl shadow-md w-40 hidden transition-all;
      animation: fadeIn 0.2s ease;
    }
    .dropdown-menu.show { display: block; }
    .dropdown-item {
      @apply px-4 py-2 text-sm hover:bg-gray-100 cursor-pointer flex items-center gap-2;
    }
  </style>
</head>
<body class="text-gray-800">

  <!-- Header -->
  <header class="bg-indigo-600 text-white py-4 shadow">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <h1 class="text-lg font-semibold flex items-center gap-2">
        <i data-feather="users"></i> SmartDent ERP
      </h1>

      <div class="flex items-center gap-3">
        <button id="addPatientBtn" class="bg-white/90 text-indigo-600 px-3 py-2 rounded-md flex items-center gap-2 shadow hover:bg-white">
          <i data-feather="plus-circle"></i> Add Patient
        </button>

        <!-- Doctor dropdown -->
        <div class="relative">
          <button id="doctorBtn" class="flex items-center gap-2 bg-white/90 px-3 py-2 rounded-full shadow-sm hover:bg-white">
            <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=100&auto=format&fit=crop"
                 class="w-8 h-8 rounded-full object-cover">
            <span class="hidden md:inline-block text-sm text-indigo-700 font-medium">Dr. Phiri</span>
            <i data-feather="chevron-down" class="text-indigo-700"></i>
          </button>
          <div id="doctorMenu" class="dropdown-menu">
            <div class="dropdown-item"><i data-feather="user"></i> Profile</div>
            <div class="dropdown-item"><i data-feather="settings"></i> Settings</div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- Patient List -->
    <section class="lg:col-span-2 card">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold">Patient Records</h2>
        <div class="flex gap-2">
          <input id="searchInput" type="text" placeholder="Search…" class="px-3 py-2 border rounded-md text-sm" />
          <button id="searchBtn" class="px-3 py-2 border rounded-md"><i data-feather="search"></i></button>
        </div>
      </div>
      <ul id="patientList" class="divide-y divide-gray-100"></ul>
    </section>

    <!-- Sidebar -->
    <aside class="space-y-6">
      <div class="card">
        <h3 class="font-semibold mb-3">Appointments Summary</h3>
        <ul class="space-y-2 text-sm">
          <li class="flex justify-between"><span>Today</span><span>38</span></li>
          <li class="flex justify-between"><span>Pending</span><span>5</span></li>
          <li class="flex justify-between"><span>Upcoming</span><span>12</span></li>
        </ul>
      </div>

      <div class="card">
        <h3 class="font-semibold mb-3">Quick Actions</h3>
        <div class="grid gap-3">
          <button class="flex items-center gap-3 px-4 py-2 rounded-lg bg-indigo-50 hover:bg-indigo-100">
            <i data-feather="calendar"></i> Schedule
          </button>
          <button class="flex items-center gap-3 px-4 py-2 rounded-lg bg-green-50 hover:bg-green-100">
            <i data-feather="users"></i> Manage Patients
          </button>
          <button class="flex items-center gap-3 px-4 py-2 rounded-lg bg-rose-50 hover:bg-rose-100">
            <i data-feather="file-text"></i> Invoicing
          </button>
        </div>
      </div>
    </aside>
  </main>

  <footer class="mt-8 text-sm text-gray-500 text-center">
    SmartDent ERP • Patient Management Simplified
  </footer>

  <!-- Modal -->
  <div id="patientModal" class="modal">
    <div class="modal-content">
      <h2 id="modalTitle" class="text-lg font-semibold mb-4">Add Patient</h2>
      <form id="patientForm" class="space-y-4">
        <input type="hidden" id="editIndex" value="">
        <div>
          <label class="block text-sm font-medium text-gray-700">Patient Name</label>
          <input type="text" id="patientName" required class="w-full px-3 py-2 border rounded-md mt-1">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Visit Note</label>
          <input type="text" id="patientNote" placeholder="e.g. Cleaning" class="w-full px-3 py-2 border rounded-md mt-1">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Status</label>
          <select id="patientStatus" class="w-full px-3 py-2 border rounded-md mt-1">
            <option>Pending</option>
            <option>Paid</option>
            <option>Overdue</option>
          </select>
        </div>
        <div class="flex justify-between pt-4">
          <button type="button" id="deleteBtn" class="px-4 py-2 bg-rose-50 text-rose-600 rounded-md hover:bg-rose-100 hidden">Delete</button>
          <div class="flex gap-2 ml-auto">
            <button type="button" id="cancelBtn" class="px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200">Cancel</button>
            <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    feather.replace();

    const ADMIN_PASSWORD = "admin123";
    let patients = JSON.parse(localStorage.getItem("patients")) || [];

    const modal = document.getElementById("patientModal");
    const form = document.getElementById("patientForm");
    const modalTitle = document.getElementById("modalTitle");
    const deleteBtn = document.getElementById("deleteBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const addBtn = document.getElementById("addPatientBtn");

    // =======================
    // Modal Logic
    // =======================
    function openModal(isEdit = false, index = null) {
      modal.classList.add("show");
      deleteBtn.classList.toggle("hidden", !isEdit);
      modalTitle.textContent = isEdit ? "Edit Patient" : "Add Patient";

      if (isEdit) {
        const p = patients[index];
        document.getElementById("patientName").value = p.name;
        document.getElementById("patientNote").value = p.note;
        document.getElementById("patientStatus").value = p.status;
        document.getElementById("editIndex").value = index;
      } else {
        form.reset();
        document.getElementById("editIndex").value = "";
      }
    }

    function closeModal() {
      modal.classList.remove("show");
      form.reset();
    }

    modal.addEventListener("click", e => { if (e.target === modal) closeModal(); });
    cancelBtn.addEventListener("click", closeModal);
    addBtn.addEventListener("click", () => openModal(false));

    // =======================
    // Render Logic
    // =======================
    function render(list = patients) {
      const ul = document.getElementById("patientList");
      ul.innerHTML = "";

      if (list.length === 0) {
        ul.innerHTML = `<li class="py-3 text-center text-gray-500 text-sm">No patient records found.</li>`;
        return;
      }

      list.forEach((p, i) => {
        const color = p.status === "Paid"
          ? "bg-green-100 text-green-700"
          : p.status === "Overdue"
          ? "bg-rose-100 text-rose-700"
          : "bg-amber-100 text-amber-700";

        const li = document.createElement("li");
        li.className = "flex items-center justify-between p-3 hover:bg-gray-50 cursor-pointer transition";
        li.innerHTML = `
          <div>
            <div class="font-medium">${p.name}</div>
            <div class="text-xs text-gray-500">${p.note} — ${p.date}</div>
          </div>
          <span class="status-pill ${color}">${p.status}</span>
        `;
        li.addEventListener("click", () => openModal(true, i));
        ul.appendChild(li);
      });
    }

    // =======================
    // Save / Delete
    // =======================
    function savePatients() { localStorage.setItem("patients", JSON.stringify(patients)); }

    form.addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("patientName").value.trim();
      const note = document.getElementById("patientNote").value.trim() || "Checkup";
      const status = document.getElementById("patientStatus").value;
      const index = document.getElementById("editIndex").value;
      const date = new Date().toLocaleDateString("en-US", { month: "short", day: "2-digit" });

      if (index) patients[index] = { ...patients[index], name, note, status };
      else patients.push({ name, note, date, status });

      savePatients();
      render();
      closeModal();
    });

    deleteBtn.addEventListener("click", () => {
      const index = document.getElementById("editIndex").value;
      const pass = prompt("Enter admin password to confirm deletion:");
      if (pass === ADMIN_PASSWORD) {
        patients.splice(index, 1);
        savePatients();
        render();
        closeModal();
        alert("Patient deleted successfully.");
      } else if (pass !== null) {
        alert("Incorrect password.");
      }
    });

    // =======================
    // Search
    // =======================
    document.getElementById("searchBtn").addEventListener("click", () => {
      const q = document.getElementById("searchInput").value.toLowerCase().trim();
      render(patients.filter(p => p.name.toLowerCase().includes(q) || p.note.toLowerCase().includes(q)));
    });

    // =======================
    // Doctor Dropdown
    // =======================
    const doctorBtn = document.getElementById("doctorBtn");
    const doctorMenu = document.getElementById("doctorMenu");
    doctorBtn.addEventListener("click", () => doctorMenu.classList.toggle("show"));
    document.addEventListener("click", e => {
      if (!doctorBtn.contains(e.target) && !doctorMenu.contains(e.target)) {
        doctorMenu.classList.remove("show");
      }
    });

    render();
  </script>
</body>
</html>
